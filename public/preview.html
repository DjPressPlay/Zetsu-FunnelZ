<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zetsu Infinity — Funnel Preview</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg, #0a0a0a 0%, #111 100%);
      color: #fff;
      line-height: 1.5;
      overflow-x: hidden;
    }

    .topbar {
      width: 100%;
      background: #000;
      border-bottom: 2px solid #fff;
      color: #00ffe1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,255,255,0.2);
    }
    .topbar-title {
      font-size: 1.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #2fffda, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
    }
    .topbar-nav {
      display: flex;
      gap: 30px;
    }
    .topbar-nav a {
      color: #00ffe1;
      text-decoration: none;
      transition: opacity .2s ease;
    }
    .topbar-nav a:hover {
      opacity: .7;
    }

    main {
      padding: 4rem 2rem;
      max-width: 1100px;
      margin: 0 auto;
      border-bottom: 2px solid #fff;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #151515;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.06);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .funnel-header {
      background: linear-gradient(135deg, #2fffda, #00d4ff);
      color: #000;
      text-align: center;
      padding: 60px 20px;
    }

    .funnel-header h1 {
      font-size: 42px;
      margin: 0 0 10px 0;
      font-weight: 700;
    }

    .funnel-header p {
      font-size: 18px;
      margin-top: 10px;
      color: #0a0a0a;
    }

    section {
      padding: 40px 30px;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }

    section:last-child {
      border-bottom: none;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 15px;
      color: #00ffe1;
      text-align: center;
    }

    p {
      font-size: 17px;
      line-height: 1.6;
      text-align: center;
      margin-bottom: 20px;
      color: #ccc;
    }

    .cta {
      display: inline-block;
      padding: 15px 35px;
      background: linear-gradient(90deg, #00ffe1, #00a2ff);
      color: #000;
      font-weight: bold;
      text-decoration: none;
      border-radius: 50px;
      font-size: 18px;
      transition: transform .2s, box-shadow .2s;
      box-shadow: 0 0 20px rgba(0,255,221,.3);
      border: none;
      cursor: pointer;
    }

    .cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(0,255,221,.6);
    }

    .price {
      font-size: 24px;
      font-weight: bold;
      margin-top: 20px;
      color: #00ffe1;
    }

    .testimonials, .videos {
      display: flex;
      justify-content: center;
      gap: 25px;
      flex-wrap: wrap;
      margin-top: 25px;
    }

    .testimonial, .video {
      flex: 1;
      min-width: 300px;
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0,255,225,0.2);
      box-shadow: 0 4px 10px rgba(0,255,225,0.1);
      transition: transform 0.3s ease;
    }

    .testimonial:hover, .video:hover {
      transform: translateY(-5px);
      border-color: rgba(0,255,225,0.4);
    }

    .testimonial img {
      max-width: 100%;
      border-radius: 8px;
    }

    .testimonial p {
      margin-top: 10px;
      font-size: 15px;
      text-align: left;
    }

    iframe {
      width: 100%;
      height: 240px;
      border-radius: 10px;
    }

    .community-section {
      text-align:center;
      padding:80px 20px;
      background: rgba(0,0,0,0.3);
    }

    .community-section h2 {
      font-size:2.2em;
      margin-bottom:20px;
    }

    .community-section img {
      width:100%;
      max-width:600px;
      border-radius:16px;
      margin-bottom:25px;
      border: 2px solid rgba(0,255,225,0.3);
    }

    .community-section p {
      max-width:600px;
      margin:0 auto 30px;
      font-size:1.1em;
      color:#ccc;
    }

    .community-buttons {
      display:flex;
      justify-content:center;
      gap:15px;
      flex-wrap:wrap;
    }

    .community-buttons a {
      background: #151515;
      color: #00ffe1;
      padding:12px 26px;
      border-radius:8px;
      text-decoration:none;
      font-weight:600;
      border: 1px solid rgba(0,255,225,0.3);
      transition: all 0.3s ease;
    }

    .community-buttons a:hover {
      background: rgba(0,255,225,0.1);
      border-color: #00ffe1;
      transform: translateY(-2px);
    }

    .secrets {
      text-align: center;
      padding: 60px 30px;
      background: rgba(0,0,0,0.3);
    }

    .secrets h2 {
      font-size: 2.2em;
      margin-bottom: 40px;
      color: #00ffe1;
    }

    .secret-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .secret-card {
      background: rgba(0,0,0,0.4);
      border: 2px solid rgba(0,255,225,0.3);
      border-radius: 12px;
      padding: 25px 20px;
      transition: all 0.3s ease;
    }

    .secret-card:hover {
      transform: translateY(-5px);
      border-color: #00ffe1;
      box-shadow: 0 8px 20px rgba(0,255,225,0.3);
    }

    .secret-header {
      color: #00ffe1;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
    }

    .secret-body {
      color: #ccc;
      font-size: 16px;
      line-height: 1.5;
      text-align: center;
    }

    .offer-section {
      text-align:center;
      padding:80px 20px;
      background: rgba(0,0,0,0.2);
    }

    .offer-section h2 {
      font-size:2.2em;
      margin-bottom:20px;
    }

    .offer-section img {
      width:100%;
      max-width:600px;
      border-radius:16px;
      margin-bottom:25px;
      border: 2px solid rgba(0,255,225,0.3);
    }

    .offer-section p {
      max-width:600px;
      margin:0 auto 30px;
      font-size:1.1em;
      color:#ccc;
    }

    .offer-section a {
      background: linear-gradient(90deg, #00ffe1, #00a2ff);
      color: #000;
      padding:14px 36px;
      border-radius:50px;
      text-decoration:none;
      font-weight:700;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(0,255,221,.3);
    }

    .offer-section a:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(0,255,221,.6);
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    #edit-btn {
      background: rgba(0,255,225,0.1);
      color: #00ffe1;
      border: 2px solid #00ffe1;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    #edit-btn:hover {
      background: rgba(0,255,225,0.2);
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(0,255,225,0.6);
    }

    .no-funnel {
      text-align: center;
      padding: 60px 20px;
    }

    .no-funnel h3 {
      color: #00ffe1;
      font-size: 24px;
      margin-bottom: 20px;
    }

    .no-funnel p {
      color: #aaa;
      margin-bottom: 30px;
    }

    footer {
      text-align: center;
      padding: 1rem 1rem;
      font-size: .75rem;
      color: #777;
      border-top: 2px solid #fff;
    }

    footer p {
      margin: 0;
      line-height: 1;
      display: inline;
    }

    footer a {
      color: #00ffe1;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width:600px) {
      .topbar { flex-direction: column; gap: 1rem; font-size: .8rem; text-align: center; }
      .topbar-nav { flex-wrap: wrap; justify-content: center; }
      .funnel-header h1 { font-size: 2rem; }
      .funnel-header p { font-size: 1rem; }
      h2 { font-size: 1.6rem; }
      .testimonials, .videos { flex-direction: column; }
      .testimonial, .video { min-width: 100%; }
      .community-section h2, .offer-section h2 { font-size: 1.6rem; }
      .community-section p, .offer-section p { font-size: 1rem; }
      .secrets h2 { font-size: 1.6rem; }
      .secret-cards { grid-template-columns: 1fr; }
      .secret-body { font-size: 14px; }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <h1 class="topbar-title">Funnel Preview</h1>
    <nav class="topbar-nav">
      <a href="index.html">Home</a>
      <a href="info.html">Info</a>
      <a href="builder.html">Builder</a>
      <a href="preview.html">Preview</a>
      <a href="affiliate.html">Affiliate</a>
    </nav>
  </div>

  <main>
    <div id="preview-content"></div>
  </main>

  <footer>
    <p>© 2025 Zetsumetsu Corporation™ | All systems, products, and materials are the property of Zetsumetsu Corporation. Unauthorized use or reproduction is prohibited. | Zetsumetsu EOe™ | Artworqq Kevin Suber |
         <br> <a href="https://sporez.netlify.app/" target="_blank">Spore'z Network</a> | <a href="#">SignalZ</a> | <a href="#">Z-Auth</a></p>
  </footer>

  <script>
    const previewContent = document.getElementById('preview-content');
    const savedData = localStorage.getItem('funnelData');

    async function loadTemplate(templateName, data) {
      try {
        const response = await fetch(`templates/${templateName}.html`);
        if (!response.ok) {
          throw new Error(`Template ${templateName} not found`);
        }
        
        let templateHTML = await response.text();
        
        Object.keys(data).forEach(key => {
          const placeholder = new RegExp(`{{${key}}}`, 'g');
          templateHTML = templateHTML.replace(placeholder, data[key] || '');
        });
        
        return templateHTML;
      } catch (error) {
        console.error('Error loading template:', error);
        return null;
      }
    }

    function extractVideoId(url) {
      if (!url) return null;
      const youtubeRegex = /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/;
      const match = url.match(youtubeRegex);
      return match ? match[1] : null;
    }

    function isImageUrl(url) {
      if (!url) return false;
      return /\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i.test(url);
    }

    function renderTestimonialMedia(url) {
      const videoId = extractVideoId(url);
      if (videoId) {
        return `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
      } else if (isImageUrl(url)) {
        return `<img src="${url}" alt="Testimonial">`;
      } else {
        return `<div style="color: #00ffe1; padding: 20px;">Media: ${url}</div>`;
      }
    }

    async function renderPreview() {
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          const template = data.template || 'classic';
          
          const templateHTML = await loadTemplate(template, data);
          
          if (templateHTML) {
            previewContent.innerHTML = `
              <div style="width: 100%;">
                ${templateHTML}
              </div>
              <div class="action-buttons">
                <button id="edit-btn">Edit Funnel</button>
              </div>
            `;

            document.getElementById('edit-btn').addEventListener('click', () => {
              window.location.href = 'builder.html';
            });
          } else {
            renderFallbackPreview(data);
          }

        } catch (e) {
          console.error('Error loading funnel data:', e);
          showNoFunnel();
        }
      } else {
        showNoFunnel();
      }
    }

    function renderFallbackPreview(data) {
      const video1Id = extractVideoId(data.video1);
      const video2Id = extractVideoId(data.video2);

      let testimonialsHTML = '';
      if (data.testimonial1Media && data.testimonial1Description) {
        testimonialsHTML += `
          <div class="testimonial">
            ${renderTestimonialMedia(data.testimonial1Media)}
            <p>"${data.testimonial1Description}"</p>
          </div>
        `;
      }
      if (data.testimonial2Media && data.testimonial2Description) {
        testimonialsHTML += `
          <div class="testimonial">
            ${renderTestimonialMedia(data.testimonial2Media)}
            <p>"${data.testimonial2Description}"</p>
          </div>
        `;
      }

      let videosHTML = '';
      if (video1Id) {
        videosHTML += `
          <div class="video">
            <iframe src="https://www.youtube.com/embed/${video1Id}" frameborder="0" allowfullscreen></iframe>
          </div>
        `;
      }
      if (video2Id) {
        videosHTML += `
          <div class="video">
            <iframe src="https://www.youtube.com/embed/${video2Id}" frameborder="0" allowfullscreen></iframe>
          </div>
        `;
      }

      previewContent.innerHTML = `
        <div class="container">
          <div class="funnel-header">
            <h1>${data.productName || 'Your Product Name'}</h1>
            <p>${data.productDescription ? data.productDescription.substring(0, 100) + '...' : 'Power your workflow with this amazing solution'}</p>
            ${data.signupLink ? `<a href="${data.signupLink}" class="cta" target="_blank">Get Started Now</a>` : '<a href="#" class="cta">Get Started Now</a>'}
            <p class="price">${data.price || '$99 • Lifetime Access'}</p>
          </div>

          <section>
            <h2>What is ${data.productName || 'This Product'}?</h2>
            <p>${data.productDescription || 'An innovative solution designed for creators, developers, and digital professionals.'}</p>
          </section>

          ${testimonialsHTML ? `
            <section>
              <h2>Customer Testimonials</h2>
              <div class="testimonials">
                ${testimonialsHTML}
              </div>
            </section>
          ` : ''}

          ${(data.secret1Header || data.secret2Header || data.secret3Header) ? `
            <section class="secrets">
              <h2>You'll Find Out...</h2>
              <div class="secret-cards">
                ${data.secret1Header ? `
                  <div class="secret-card">
                    <div class="secret-header">${data.secret1Header}</div>
                    <div class="secret-body">${data.secret1Body || ''}</div>
                  </div>
                ` : ''}
                ${data.secret2Header ? `
                  <div class="secret-card">
                    <div class="secret-header">${data.secret2Header}</div>
                    <div class="secret-body">${data.secret2Body || ''}</div>
                  </div>
                ` : ''}
                ${data.secret3Header ? `
                  <div class="secret-card">
                    <div class="secret-header">${data.secret3Header}</div>
                    <div class="secret-body">${data.secret3Body || ''}</div>
                  </div>
                ` : ''}
              </div>
            </section>
          ` : ''}

          ${videosHTML ? `
            <section>
              <h2>Watch How It Works</h2>
              <div class="videos">
                ${videosHTML}
              </div>
            </section>
          ` : ''}

          <section class="community-section">
            <h2>Join the Community</h2>
            <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=600&q=80" alt="Community Preview">
            <p>${data.bonusConfirmation || 'Book a live session, join our community, or catch our next stream to see this product in action.'}</p>
            <div class="community-buttons">
              ${data.scheduleCall ? `<a href="${data.scheduleCall}" target="_blank">Schedule a Call</a>` : '<a href="#">Schedule a Call</a>'}
              ${data.livestreamEvent ? `<a href="${data.livestreamEvent}" target="_blank">Join Live Stream</a>` : '<a href="#">Join Live Stream</a>'}
            </div>
          </section>

          <section class="offer-section">
            <h2>Limited-Time Offer</h2>
            <img src="https://images.unsplash.com/photo-1607083206869-4c7672e72a8a?w=600&q=80" alt="Offer Preview">
            <p>Get started today and unlock exclusive bonuses, premium support, and lifetime access.</p>
            ${data.signupLink ? `<a href="${data.signupLink}" target="_blank">Claim Your Offer</a>` : '<a href="#">Claim Your Offer</a>'}
          </section>
        </div>

        <div class="action-buttons">
          <button id="edit-btn">Edit Funnel</button>
        </div>
      `;

      document.getElementById('edit-btn').addEventListener('click', () => {
        window.location.href = 'builder.html';
      });
    }

    function showNoFunnel() {
      previewContent.innerHTML = `
        <div class="no-funnel">
          <h3>No Funnel Found</h3>
          <p>You haven't created a funnel yet. Head to the builder to get started!</p>
          <button id="go-builder-btn" style="background: linear-gradient(90deg, #00ffe1, #00a2ff); color: #000; border: 2px solid #00ffe1; padding: 15px 30px; font-size: 16px; font-weight: 600; border-radius: 50px; cursor: pointer;">
            Go to Builder
          </button>
        </div>
      `;

      document.getElementById('go-builder-btn').addEventListener('click', () => {
        window.location.href = 'builder.html';
      });
    }

    renderPreview();
  </script>

</body>
</html>
